<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Edit Post</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="container mt-4">
<h1 class="mb-4 text-center">‚úèÔ∏è Edit Post</h1>

<form th:action="@{/post/update/{id}(id=${post.id})}" th:object="${post}" method="post" enctype="multipart/form-data">

    <!-- TITLE -->
    <div class="mb-3">
        <label class="form-label fw-bold">Title</label>
        <input type="text" th:field="*{title}" class="form-control" required>
    </div>

    <!-- CONTENT (CKEditor) -->
    <div class="mb-3">
        <label class="form-label fw-bold">Content</label>
        <textarea id="content" th:field="*{content}" class="form-control" rows="10"></textarea>
    </div>

    <!-- CATEGORY -->
    <div class="mb-3">
        <label class="form-label fw-bold">Category</label>
        <select th:field="*{category.id}" class="form-select">
            <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}"></option>
        </select>
    </div>

    <!-- IMAGE -->
    <div class="mb-3">
        <label class="form-label fw-bold">Image URL</label>
        <input type="text" th:field="*{imageUrl}" class="form-control" placeholder="Paste image link...">
        <div class="mt-3" th:if="${post.imageUrl != null}">
            <img th:src="${post.imageUrl}" alt="Post Image" class="img-fluid rounded shadow-sm" style="max-height: 250px;">
        </div>
    </div>

    <!-- YOUTUBE VIDEO -->
    <div class="mb-3">
        <label class="form-label fw-bold">YouTube Video URL</label>
        <input type="text" th:field="*{videoUrl}" class="form-control" placeholder="https://www.youtube.com/watch?v=...">
        <div class="mt-3 ratio ratio-16x9" th:if="${post.videoUrl != null}">
            <iframe th:src="@{${post.videoUrl}}" allowfullscreen></iframe>
        </div>
    </div>

    <!-- UPLOAD VIDEO -->
    <div class="mb-3">
        <label class="form-label fw-bold">Upload New Video</label>
        <input type="file" name="file" class="form-control">
        <div class="mt-3" th:if="${post.videoFile != null}">
            <video width="400" height="230" controls class="rounded shadow-sm">
                <source th:src="@{${post.videoFile}}" type="video/mp4">
            </video>
        </div>
    </div>

    <!-- BUTTONS -->
    <div class="text-center mt-4">
        <button type="submit" class="btn btn-success px-4">üíæ Update</button>
        <a href="/" class="btn btn-secondary px-4">Cancel</a>
    </div>
</form>

<!-- ‚úÖ CKEditor 5 -->
<script src="https://cdn.ckeditor.com/ckeditor5/39.0.1/classic/ckeditor.js"></script>
<script>
    let editorInstance;

    ClassicEditor.create(document.querySelector('#content'))
      .then(editor => {
          editorInstance = editor;
      })
      .catch(error => console.error(error));

    document.querySelector('form').addEventListener('submit', function(e) {
        const data = editorInstance.getData().trim();
        if (data === '') {
            e.preventDefault();
            alert('Vui l√≤ng nh·∫≠p n·ªôi dung b√†i vi·∫øt!');
            return;
        }
        document.querySelector('#content').value = data;
    });
</script>

</body>
</html>
